<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bootstrap Confidence Intervals • rsample</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Bootstrap Confidence Intervals">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">rsample</a>
        <div class="info">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.0.4.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../articles/Basics.html">Basic Usage</a>
</li>
<li>
  <a href="../../articles/Working_with_rsets.html">Working with Resample Sets</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Application Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/Applications/Recipes_and_rsample.html">Recipes and rsample</a>
    </li>
    <li>
      <a href="../../articles/Applications/Time_Series.html">Time Series Analysis</a>
    </li>
    <li>
      <a href="../../articles/Applications/Survival_Analysis.html">Survival Analysis</a>
    </li>
    <li>
      <a href="../../articles/Applications/Nested_Resampling.html">Tuning Models using Nested Resampling</a>
    </li>
    <li>
      <a href="../../articles/Applications/Keras.html">Grid Search Tuning of Keras Models</a>
    </li>
    <li>
      <a href="../../articles/Applications/Intervals.html">Bootstrap Interval Estimation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
        
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Bootstrap Confidence Intervals</h1>
            
      
      
      <div class="hidden name"><code>Intervals.Rmd</code></div>

    </div>

    
    
<p>The bootstrap was originally intended for estimating confidence intervals for complex statistics whose variance properties are difficult to analytically derive. Davison and Hinkley’s <a href="https://www.cambridge.org/core/books/bootstrap-methods-and-their-application/ED2FD043579F27952363566DC09CBD6A"><em>Bootstrap Methods and Their Applications</em></a> is a great resource for these methods. <code>rsample</code> contains a few function to compute the most common types of intervals.</p>
<p>To demonstrate the computations for the different types of intervals, we’ll use a event time data set and parametric survival models. We’ll use the ubiquitous Ovarian cancer data to demonstrate with a simple model with two terms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rsample)
<span class="kw">library</span>(purrr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(survival)

f &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/survival/topics/Surv">Surv</a></span>(futime, fustat) <span class="op">~</span><span class="st"> </span>ecog.ps <span class="op">+</span><span class="st"> </span>rx

<span class="co"># Will be used to fit the models to different bootstrap data sets:</span>
fit_fun &lt;-<span class="st"> </span><span class="cf">function</span>(split, ...) {
  <span class="kw"><a href="http://www.rdocumentation.org/packages/survival/topics/survreg">survreg</a></span>(..., <span class="dt">data =</span> <span class="kw"><a href="../../reference/as.data.frame.rsplit.html">analysis</a></span>(split))
}</code></pre></div>
<p>First, let’s create a set of resamples and fit separate models to each. The options <code>apparent = TRUE</code> will be set. This create a final resample that is simple a copy of the original (unsampled) data set. This is required for some of the interval methods.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">462</span>)
ov_bt &lt;-
<span class="st">  </span><span class="kw"><a href="../../reference/bootstraps.html">bootstraps</a></span>(ovarian, <span class="dt">times =</span> <span class="dv">2000</span>, <span class="dt">apparent =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">models =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(splits, fit_fun, f, <span class="dt">dist =</span> <span class="st">'weibull'</span>))
ov_bt</code></pre></div>
<pre><code>## # Bootstrap sampling with apparent sample 
## # A tibble: 2,001 x 3
##    splits          id            models       
##  * &lt;list&gt;          &lt;chr&gt;         &lt;list&gt;       
##  1 &lt;split [26/9]&gt;  Bootstrap0001 &lt;S3: survreg&gt;
##  2 &lt;split [26/9]&gt;  Bootstrap0002 &lt;S3: survreg&gt;
##  3 &lt;split [26/9]&gt;  Bootstrap0003 &lt;S3: survreg&gt;
##  4 &lt;split [26/8]&gt;  Bootstrap0004 &lt;S3: survreg&gt;
##  5 &lt;split [26/8]&gt;  Bootstrap0005 &lt;S3: survreg&gt;
##  6 &lt;split [26/11]&gt; Bootstrap0006 &lt;S3: survreg&gt;
##  7 &lt;split [26/8]&gt;  Bootstrap0007 &lt;S3: survreg&gt;
##  8 &lt;split [26/10]&gt; Bootstrap0008 &lt;S3: survreg&gt;
##  9 &lt;split [26/11]&gt; Bootstrap0009 &lt;S3: survreg&gt;
## 10 &lt;split [26/10]&gt; Bootstrap0010 &lt;S3: survreg&gt;
## # … with 1,991 more rows</code></pre>
<p>For each of the interval methods, we’ll need to extract the coefficients from each model. The <code>tidy</code> method can do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># For one model:</span>
one_model &lt;-<span class="st"> </span>
<span class="st">  </span>ov_bt <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(models) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span>(<span class="dv">1</span>)
one_model</code></pre></div>
<pre><code>## Call:
## survreg(formula = ..1, data = analysis(split), dist = "weibull")
## 
## Coefficients:
## (Intercept)     ecog.ps          rx 
##   8.1289142  -1.1085280   0.2434273 
## 
## Scale= 0.6680351 
## 
## Loglik(model)= -106.3   Loglik(intercept only)= -111
##  Chisq= 9.36 on 2 degrees of freedom, p= 0.00929 
## n= 26</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">one_model <span class="op">%&gt;%</span><span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>()</code></pre></div>
<pre><code>## # A tibble: 4 x 7
##   term        estimate std.error statistic  p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)    8.13      0.932     8.72  2.82e-18    6.30      9.96 
## 2 ecog.ps       -1.11      0.428    -2.59  9.59e- 3   -1.95     -0.270
## 3 rx             0.243     0.369     0.659 5.10e- 1   -0.481     0.968
## 4 Log(scale)    -0.403     0.221    -1.83  6.75e- 2   NA        NA</code></pre>
<p>We will focus on the model terms for <code>rx</code> and the Weibull scale parameter here. Note that the scale parameter does not have a parametric confidence interval. For each model, we can extract these specific parameter estimates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ov_bt &lt;-
<span class="st">  </span>ov_bt <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="dt">rx =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(
      models,
      <span class="op">~</span><span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(.x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(term <span class="op">==</span><span class="st"> "rx"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(estimate)
    ),
    <span class="dt">log_scale =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(
      models,
      <span class="op">~</span><span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(.x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(term <span class="op">==</span><span class="st"> "Log(scale)"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(estimate)
    )
  )</code></pre></div>
<p>However, if we look at the estimates, there are some outliers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(ov_bt, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> rx, <span class="dt">y =</span> log_scale)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="dt">alpha =</span> .<span class="dv">3</span>)</code></pre></div>
<p><img src="Intervals_files/figure-html/coef-plot-1.png" width="700"></p>
<p>These aberrant points correspond to models that had convergence issues. Let’s extract the number of iterations and filter out models that required more than 15 iterations. The distributions are less problematic by doing this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ov_bt_filtered &lt;-
<span class="st">  </span>ov_bt <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">iters =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span>(models, pluck, <span class="st">"iter"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(iters <span class="op">&lt;=</span><span class="st"> </span><span class="dv">15</span>)

<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(ov_bt_filtered, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> rx, <span class="dt">y =</span> log_scale)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="dt">alpha =</span> .<span class="dv">3</span>)</code></pre></div>
<p><img src="Intervals_files/figure-html/filtered-1.png" width="700"></p>
<p>Three were 26 models removed by doing so.</p>
<p>The univariate distirbutions are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ov_bt_filtered <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(rx, log_scale) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(terms, statistic) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> statistic)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">fill =</span> <span class="st">"red"</span>, <span class="dt">alpha =</span> .<span class="dv">5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="st"> </span>terms, <span class="dt">scales =</span> <span class="st">"free_x"</span>)</code></pre></div>
<p><img src="Intervals_files/figure-html/hists-1.png" width="700"></p>
<p>The most basic type of interval uses <em>percentiles</em> of the resampling distribution. To get the percentile intervals, the <code>rset</code> objects is passed as the first argument and the columns of interest in the <code>rset</code> object are passed (unquoted):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_ints &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/int_pctl.html">int_pctl</a></span>(ov_bt_filtered, rx, log_scale)
p_ints</code></pre></div>
<pre><code>## # A tibble: 2 x 6
##    lower estimate upper alpha .method    statistic
##    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    
## 1 -0.592    0.570 1.93   0.05 percentile rx       
## 2 -0.617   -0.208 0.157  0.05 percentile log_scale</code></pre>
<p>When overlyed with the univariate distributions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ov_bt_filtered <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(rx, log_scale) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(statistic, coefficients) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> coefficients)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">fill =</span> <span class="st">"red"</span>, <span class="dt">alpha =</span> .<span class="dv">5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="st"> </span>statistic, <span class="dt">scales =</span> <span class="st">"free_x"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="dt">data =</span> p_ints, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">xintercept =</span> lower)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="dt">data =</span> p_ints, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">xintercept =</span> upper))</code></pre></div>
<p><img src="Intervals_files/figure-html/pctl-plot-1.png" width="700"></p>
<p>How does these compare to the parametric asymptotic values?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">full_model &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/survival/topics/survreg">survreg</a></span>(f, <span class="dt">data =</span> ovarian, <span class="dt">dist =</span> <span class="st">'weibull'</span>)

parametric &lt;-<span class="st"> </span>
<span class="st">  </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(full_model) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(conf.low, estimate, conf.high, term) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(term <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"rx"</span>, <span class="st">"Log(scale)"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">lower =</span> conf.low, <span class="dt">upper =</span> conf.high, <span class="dt">statistic =</span> term) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">alpha =</span> <span class="fl">0.05</span>, <span class="dt">.method =</span> <span class="st">"parametric"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(lower, estimate, upper, alpha, .method, statistic)

intervals &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(parametric, p_ints) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(statistic, .method)
intervals</code></pre></div>
<pre><code>## # A tibble: 4 x 6
##     lower estimate  upper alpha .method    statistic 
##     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     
## 1  -0.617   -0.208  0.157  0.05 percentile log_scale 
## 2  NA       -0.123 NA      0.05 parametric Log(scale)
## 3  -0.509    0.529  1.57   0.05 parametric rx        
## 4  -0.592    0.570  1.93   0.05 percentile rx</code></pre>
<p>These are wider than the parametric intervals (which assume asymptotic normality). Do the estimates appear to be normally distributed? We can look at quantile-quantile plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ov_bt_filtered <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(rx, log_scale) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(statistic, coefficients) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">sample =</span> coefficients))  <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="st"> </span>statistic, <span class="dt">scales =</span> <span class="st">"free"</span>) <span class="op">+</span><span class="st">  </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq_line</a></span>()</code></pre></div>
<p><img src="Intervals_files/figure-html/qqplot-1.png" width="700"></p>
<p>The departures from normality may account for the different in the intervals (and would suggest that the nonparametric estimates are better).</p>
<p>Bootstrap <em>t</em>-intervals are estimated by computing intermediate statistics that are <em>t</em>-like in structure. To use these, we require the estimated variance <em>for each individual resampled estimate</em>. In our example, this comes along with the fitted model object. We can extract the variance of the parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ov_bt_filtered &lt;-
<span class="st">  </span>ov_bt_filtered <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="dt">rx_var =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(
      models,
      <span class="op">~</span><span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(.x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(term <span class="op">==</span><span class="st"> "rx"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(std.error)
    ),
    <span class="dt">rx_var =</span> rx_var<span class="op">^</span><span class="dv">2</span>,
    <span class="dt">log_scale_var =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(
      models,
      <span class="op">~</span><span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(.x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(term <span class="op">==</span><span class="st"> "Log(scale)"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(std.error)
    ),
    <span class="dt">log_scale_var =</span> log_scale_var<span class="op">^</span><span class="dv">2</span>
  )

ov_bt_filtered <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>id, <span class="op">-</span>models, <span class="op">-</span>splits, <span class="op">-</span>iters) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</code></pre></div>
<pre><code>## # A tibble: 4 x 4
##       rx log_scale rx_var log_scale_var
##    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt;
## 1  0.243   -0.403   0.137        0.0487
## 2  1.34    -0.329   0.242        0.0644
## 3 -0.316   -0.294   0.277        0.0801
## 4  0.676    0.0411  0.391        0.0580</code></pre>
<p>The <em>t</em>-intervals require the names of the variance columns (assumed to be in the same order as the original values). These names can be wrapped inside of a <code>dplyr</code> <code>vars</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t_ints &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/int_pctl.html">int_t</a></span>(ov_bt_filtered, rx, log_scale, <span class="dt">var_cols =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">ends_with</a></span>(<span class="st">"var"</span>)))
intervals &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(intervals, t_ints) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(statistic, .method)
intervals</code></pre></div>
<pre><code>## # A tibble: 6 x 6
##     lower estimate  upper alpha .method    statistic 
##     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     
## 1  -0.617   -0.208  0.157  0.05 percentile log_scale 
## 2  -0.374   -0.208  0.413  0.05 student-t  log_scale 
## 3  NA       -0.123 NA      0.05 parametric Log(scale)
## 4  -0.509    0.529  1.57   0.05 parametric rx        
## 5  -0.592    0.570  1.93   0.05 percentile rx        
## 6  -0.513    0.570  1.82   0.05 student-t  rx</code></pre>
<p>For bias-corrected (BCa) intervals, a different type of argument is required. The <code>fn</code> argument is a function that computes the statistic of interest. The first argument should be for an <code>rsplit</code> object and other arguments can be passed in using the ellipses. For example, to get the <code>rx</code> coefficient for the model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod_coef &lt;-<span class="st"> </span><span class="cf">function</span>(split, ..., term_name) {
  res &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/survival/topics/survreg">survreg</a></span>(..., <span class="dt">data =</span> <span class="kw"><a href="../../reference/as.data.frame.rsplit.html">analysis</a></span>(split))
  rx_est &lt;-
<span class="st">    </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(res) <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(term <span class="op">==</span><span class="st"> </span>term_name) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(estimate)

  rx_est
}

<span class="kw">mod_coef</span>(ov_bt_filtered<span class="op">$</span>splits[[<span class="dv">1</span>]], f, <span class="dt">dist =</span> <span class="st">"weibull"</span>, <span class="dt">term_name =</span> <span class="st">"rx"</span>)</code></pre></div>
<pre><code>## [1] 0.2434273</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># checking: </span>
ov_bt_filtered<span class="op">$</span>rx[[<span class="dv">1</span>]]</code></pre></div>
<pre><code>## [1] 0.2434273</code></pre>
<p>These intervals use an internal leave-one-out resample to compute the Jackknife statistic and will recompute the statistic for <em>every bootstrap resample</em>. If the statistic is expensive to compute, this make take some time.</p>
<p>The user-facing function takes this function and a named list (called <code>args</code>) for any additional arguments that should be directed to the <code>...</code>. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b_int_rx &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/int_pctl.html">int_bca</a></span>(
    ov_bt_filtered,
    rx,
    <span class="dt">fn =</span> mod_coef,
    <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">formula =</span> f, <span class="dt">dist =</span> <span class="st">"weibull"</span>, <span class="dt">term_name =</span> <span class="st">"rx"</span>)
  )
b_int_scale &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/int_pctl.html">int_bca</a></span>(
    ov_bt_filtered,
    log_scale,
    <span class="dt">fn =</span> mod_coef,
    <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">formula =</span> f, <span class="dt">dist =</span> <span class="st">"weibull"</span>, <span class="dt">term_name =</span> <span class="st">"Log(scale)"</span>)
  )
intervals &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(intervals, b_int_rx, b_int_scale) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(statistic, .method)
intervals</code></pre></div>
<pre><code>## # A tibble: 8 x 6
##     lower estimate  upper alpha .method    statistic 
##     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     
## 1  -0.434   -0.208  0.350  0.05 BCa        log_scale 
## 2  -0.617   -0.208  0.157  0.05 percentile log_scale 
## 3  -0.374   -0.208  0.413  0.05 student-t  log_scale 
## 4  NA       -0.123 NA      0.05 parametric Log(scale)
## 5  -0.590    0.570  1.94   0.05 BCa        rx        
## 6  -0.509    0.529  1.57   0.05 parametric rx        
## 7  -0.592    0.570  1.93   0.05 percentile rx        
## 8  -0.513    0.570  1.82   0.05 student-t  rx</code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="tidyverse">
  <p><code>rsample</code> is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn, Chow Fanny, <a href="http://hadley.nz">Hadley Wickham</a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>
      </footer>
</div>

  

  </body>
</html>
