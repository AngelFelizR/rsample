<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • rsample</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rsample</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/Basics.html">Basic Usage</a>
</li>
<li>
  <a href="../articles/Working_with_rsets.html">Working with Resample Sets</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1></h1>
            
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>rsample</code> can be used to create objects containing resamples of the original data. This page contains examples of how those objects can be used for data analysis.</p>
<p>For illustration, the <code>Sacramento</code> housing data is used. From the <code>caret</code> package:</p>
<blockquote>
<p>This data frame contains house and sale price data for 932 homes in Sacramento CA. The original data were obtained from the website for the SpatialKey software. From their website: “The Sacramento real estate transactions file is a list of 985 real estate transactions in the Sacramento area reported over a five-day period, as reported by the Sacramento Bee.” Google was used to fill in missing/incorrect data.</p>
</blockquote>
<p>The data can be accessed using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caret)
<span class="kw">data</span>(Sacramento)
<span class="kw">str</span>(Sacramento)
<span class="co">#&gt; 'data.frame':    932 obs. of  9 variables:</span>
<span class="co">#&gt;  $ city     : Factor w/ 37 levels "ANTELOPE","AUBURN",..: 34 34 34 34 34 34 34 34 29 31 ...</span>
<span class="co">#&gt;  $ zip      : Factor w/ 68 levels "z95603","z95608",..: 64 52 44 44 53 65 66 49 24 25 ...</span>
<span class="co">#&gt;  $ beds     : int  2 3 2 2 2 3 3 3 2 3 ...</span>
<span class="co">#&gt;  $ baths    : num  1 1 1 1 1 1 2 1 2 2 ...</span>
<span class="co">#&gt;  $ sqft     : int  836 1167 796 852 797 1122 1104 1177 941 1146 ...</span>
<span class="co">#&gt;  $ type     : Factor w/ 3 levels "Condo","Multi_Family",..: 3 3 3 3 3 1 3 3 1 3 ...</span>
<span class="co">#&gt;  $ price    : int  59222 68212 68880 69307 81900 89921 90895 91002 94905 98937 ...</span>
<span class="co">#&gt;  $ latitude : num  38.6 38.5 38.6 38.6 38.5 ...</span>
<span class="co">#&gt;  $ longitude: num  -121 -121 -121 -121 -121 ...</span></code></pre></div>
</div>
<div id="model-assessment" class="section level2">
<h2 class="hasAnchor">
<a href="#model-assessment" class="anchor"></a>Model Assessment</h2>
<p>Let’s fit a linear regression model to the data with model terms for the number of bedrooms, the number of bathrooms, the square footage, and the type of house (‘Condo’, ‘Multi_Family’, or ‘Residential’).</p>
<p>If we were fitting the model to the entire data set, we might model the logarithm of the sale price using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lm</span>(<span class="kw">log</span>(price) <span class="op">~</span><span class="st"> </span>beds <span class="op">+</span><span class="st"> </span>baths <span class="op">+</span><span class="st"> </span>sqft <span class="op">+</span><span class="st"> </span>type, <span class="dt">data =</span> Sacramento)</code></pre></div>
<p>To evaluate this model, we will use 10 repeats of 10-fold cross-validation and use the 100 holdout samples to evaluate the root mean squared error (in log dollar units).</p>
<p>First, let’s make the splits of the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rsample)
<span class="kw">set.seed</span>(<span class="dv">4622</span>)
rs_obj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vfold_cv.html">vfold_cv</a></span>(Sacramento, <span class="dt">V =</span> <span class="dv">10</span>, <span class="dt">repeats =</span> <span class="dv">10</span>)
rs_obj
<span class="co">#&gt; # 10-fold cross-validation repeated 10 times </span>
<span class="co">#&gt; # A tibble: 100 x 3</span>
<span class="co">#&gt;         splits       id    id2</span>
<span class="co">#&gt; *       &lt;list&gt;    &lt;chr&gt;  &lt;chr&gt;</span>
<span class="co">#&gt; 1 &lt;S3: rsplit&gt; Repeat01 Fold01</span>
<span class="co">#&gt; 2 &lt;S3: rsplit&gt; Repeat01 Fold02</span>
<span class="co">#&gt; 3 &lt;S3: rsplit&gt; Repeat01 Fold03</span>
<span class="co">#&gt; 4 &lt;S3: rsplit&gt; Repeat01 Fold04</span>
<span class="co">#&gt; # ... with 96 more rows</span></code></pre></div>
<p>Now let’s write a function that will, for each resample:</p>
<ol style="list-style-type: decimal">
<li>obtain the analysis data set (i.e. the 90% used for modeling)</li>
<li>fit a linear model</li>
<li>predict the assessment data (the other 10% not used for the model) using the <code>broom</code> package</li>
<li>calculate the residuals on the assessment data</li>
</ol>
<p>Here is our function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)
## splits will be the `rsplit` object with the 90/10 partition
holdout_resids &lt;-<span class="st"> </span><span class="cf">function</span>(splits, ...) {
  <span class="co"># Fit the model to the 90%</span>
  mod &lt;-<span class="st"> </span><span class="kw">lm</span>(..., <span class="dt">data =</span> <span class="kw"><a href="../reference/as.data.frame.rsplit.html">analysis</a></span>(splits))
  <span class="co"># Save the 10%</span>
  holdout &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.data.frame.rsplit.html">assessment</a></span>(splits)
  <span class="co"># `augment` will save the predictions with the holdout data set</span>
  res &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw">augment</span>(mod, <span class="dt">newdata =</span> holdout)
  <span class="co"># Calculate the residuals</span>
  res<span class="op">$</span>.resid &lt;-<span class="st"> </span><span class="kw">log</span>(holdout<span class="op">$</span>price) <span class="op">-</span><span class="st"> </span>res<span class="op">$</span>.fitted
  <span class="co"># Return the assessment data set wit the additional columns</span>
  res
}</code></pre></div>
<p>For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(
  <span class="kw">holdout_resids</span>(rs_obj<span class="op">$</span>splits[[<span class="dv">1</span>]], 
                 <span class="kw">log</span>(price) <span class="op">~</span><span class="st"> </span>beds <span class="op">+</span><span class="st"> </span>baths <span class="op">+</span><span class="st"> </span>sqft <span class="op">+</span><span class="st"> </span>type
  )
)
<span class="co">#&gt; 'data.frame':    94 obs. of  13 variables:</span>
<span class="co">#&gt;  $ .rownames: chr  "3" "42" "44" "49" ...</span>
<span class="co">#&gt;  $ city     : Factor w/ 37 levels "ANTELOPE","AUBURN",..: 34 34 1 34 34 4 1 34 34 29 ...</span>
<span class="co">#&gt;  $ zip      : Factor w/ 68 levels "z95603","z95608",..: 44 51 67 64 52 2 67 62 52 24 ...</span>
<span class="co">#&gt;  $ beds     : int  2 3 2 4 3 3 3 2 3 3 ...</span>
<span class="co">#&gt;  $ baths    : num  1 2 2 2 2 1 2 3 2 2 ...</span>
<span class="co">#&gt;  $ sqft     : int  796 1207 1043 1656 1185 1152 1362 1665 1478 1287 ...</span>
<span class="co">#&gt;  $ type     : Factor w/ 3 levels "Condo","Multi_Family",..: 3 3 3 3 3 3 3 3 3 3 ...</span>
<span class="co">#&gt;  $ price    : int  68880 154000 161250 166357 178480 181872 194818 206000 231477 234697 ...</span>
<span class="co">#&gt;  $ latitude : num  38.6 38.5 38.7 38.6 38.5 ...</span>
<span class="co">#&gt;  $ longitude: num  -121 -121 -121 -121 -121 ...</span>
<span class="co">#&gt;  $ .fitted  : num  11.8 12.1 12 12.2 12 ...</span>
<span class="co">#&gt;  $ .se.fit  : num  0.0251 0.0178 0.0292 0.0201 0.0182 ...</span>
<span class="co">#&gt;  $ .resid   : num  -0.6964 -0.112 -0.0457 -0.2045 0.047 ...</span></code></pre></div>
<p>To compute this data set for each of the 100 resamples, we’ll use the <code>map</code> function from the <code>purrr</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(purrr)
rs_obj<span class="op">$</span>results &lt;-<span class="st"> </span><span class="kw">map</span>(rs_obj<span class="op">$</span>splits,
                      holdout_resids,
                      <span class="kw">log</span>(price) <span class="op">~</span><span class="st"> </span>beds <span class="op">+</span><span class="st"> </span>baths <span class="op">+</span><span class="st"> </span>sqft <span class="op">+</span><span class="st"> </span>type)
rs_obj
<span class="co">#&gt; # 10-fold cross-validation repeated 10 times </span>
<span class="co">#&gt; # A tibble: 100 x 4</span>
<span class="co">#&gt;         splits       id    id2                results</span>
<span class="co">#&gt; *       &lt;list&gt;    &lt;chr&gt;  &lt;chr&gt;                 &lt;list&gt;</span>
<span class="co">#&gt; 1 &lt;S3: rsplit&gt; Repeat01 Fold01 &lt;data.frame [94 x 13]&gt;</span>
<span class="co">#&gt; 2 &lt;S3: rsplit&gt; Repeat01 Fold02 &lt;data.frame [94 x 13]&gt;</span>
<span class="co">#&gt; 3 &lt;S3: rsplit&gt; Repeat01 Fold03 &lt;data.frame [93 x 13]&gt;</span>
<span class="co">#&gt; 4 &lt;S3: rsplit&gt; Repeat01 Fold04 &lt;data.frame [93 x 13]&gt;</span>
<span class="co">#&gt; # ... with 96 more rows</span></code></pre></div>
<p>Now we can compute the RMSE values for all of the assessment data sets:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rmse &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">sqrt</span>(<span class="kw">mean</span>(x<span class="op">$</span>.resid<span class="op">^</span><span class="dv">2</span>))
rs_obj<span class="op">$</span>rmse &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(rs_obj<span class="op">$</span>results, rmse)</code></pre></div>
</div>
<div id="using-the-bootstrap-to-make-comparisons" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-bootstrap-to-make-comparisons" class="anchor"></a>Using the Bootstrap to Make Comparisons</h2>
<p>Traditionally, the bootstrap has been primarily used to empirically determine the sampling distribution of a test statistic. Given a set of samples with replacement, a statistic can be calculated on each analysis set and the results can be used to make inferences (such as confidence intervals).</p>
<p>Consider the types of properties in these data. Are there differences in the sale prices between groups?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(Sacramento, <span class="kw">aes</span>(<span class="dt">x =</span> type, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre></div>
<p><img src="Working_with_rsets_files/figure-html/type_plot-1.png" width="672"></p>
<p>If we wanted to compare the residential and multi-family properties, we could conduct a <em>t</em>-test on the logarithm of the sale prices. Instead, let’s use the bootstrap to see if there is a difference in the median sale prices for the two groups in the regular dollar units. We need a simple function to compute this statistic on the resample:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_diff &lt;-<span class="st"> </span><span class="cf">function</span>(splits) {
  x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.data.frame.rsplit.html">analysis</a></span>(splits)
  <span class="kw">median</span>(x<span class="op">$</span>price[x<span class="op">$</span>type <span class="op">==</span><span class="st"> "Residential"</span>]) <span class="op">-</span><span class="st"> </span>
<span class="st">      </span><span class="kw">median</span>(x<span class="op">$</span>price[x<span class="op">$</span>type <span class="op">==</span><span class="st"> "Multi_Family"</span>])     
}</code></pre></div>
<p>Now we would create a large number of bootstrap samples (say 2000+). For illustration, we’ll only do 200 in this document.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">353</span>)
bt_resamples &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bootstraps.html">bootstraps</a></span>(Sacramento, <span class="dt">times =</span> <span class="dv">200</span>)</code></pre></div>
<p>This function is then computed across each resample:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bt_resamples<span class="op">$</span>statistic &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(bt_resamples<span class="op">$</span>splits, mean_diff)</code></pre></div>
<p>The bootstrap distribution of this statistic looks fairly well-behaved:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(bt_resamples, <span class="kw">aes</span>(<span class="dt">x =</span> statistic)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">"density"</span>, <span class="dt">adjust =</span> <span class="fl">1.25</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"median(Residential) - median(Multi_Family)"</span>)</code></pre></div>
<p><img src="Working_with_rsets_files/figure-html/stats_plot-1.png" width="672"></p>
<p>The variation is considerable in this statistic. One method of computing a confidence interval is to take the percentiles of the bootstrap distribution. A 95% confidence interval for the difference in the means would be:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(bt_resamples<span class="op">$</span>statistic, 
         <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.500</span>, <span class="fl">0.975</span>))
<span class="co">#&gt;      2.5%       50%     97.5% </span>
<span class="co">#&gt; -62402.50   8111.50  59038.16</span></code></pre></div>
<p><em>On average</em>, there is no evidence for a difference in the sale prices in these types of homes.</p>
</div>
<div id="bootstrap-estimates-of-model-coefficients" class="section level2">
<h2 class="hasAnchor">
<a href="#bootstrap-estimates-of-model-coefficients" class="anchor"></a>Bootstrap Estimates of Model Coefficients</h2>
<p>Unless there is already a column in the resample object that contains the fitted model, a function can be used to fit the model and save all of the model coefficients. As before, <code>purrr::map</code> can be used to estimate and save these values for each split.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lm_coefs &lt;-<span class="st"> </span><span class="cf">function</span>(splits, ...) {
  ## use `analysis` or `as.data.frame` to get the analysis data
  mod &lt;-<span class="st"> </span><span class="kw">lm</span>(..., <span class="dt">data =</span> <span class="kw"><a href="../reference/as.data.frame.rsplit.html">analysis</a></span>(splits))
  <span class="kw">as.data.frame</span>(<span class="kw">t</span>(<span class="kw">coef</span>(mod)))
}
bt_resamples<span class="op">$</span>betas &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dt">.x =</span> bt_resamples<span class="op">$</span>splits, 
                          <span class="dt">.f =</span> lm_coefs, 
                          <span class="kw">log</span>(price) <span class="op">~</span><span class="st"> </span>beds <span class="op">+</span><span class="st"> </span>baths <span class="op">+</span><span class="st"> </span>sqft <span class="op">+</span><span class="st"> </span>type)
bt_resamples
<span class="co">#&gt; # Bootstrap sampling with 200 resamples </span>
<span class="co">#&gt; # A tibble: 200 x 4</span>
<span class="co">#&gt;         splits           id statistic                betas</span>
<span class="co">#&gt;         &lt;list&gt;        &lt;chr&gt;     &lt;dbl&gt;               &lt;list&gt;</span>
<span class="co">#&gt; 1 &lt;S3: rsplit&gt; Bootstrap001    -44227 &lt;data.frame [1 x 6]&gt;</span>
<span class="co">#&gt; 2 &lt;S3: rsplit&gt; Bootstrap002     19585 &lt;data.frame [1 x 6]&gt;</span>
<span class="co">#&gt; 3 &lt;S3: rsplit&gt; Bootstrap003     35000 &lt;data.frame [1 x 6]&gt;</span>
<span class="co">#&gt; 4 &lt;S3: rsplit&gt; Bootstrap004     50420 &lt;data.frame [1 x 6]&gt;</span>
<span class="co">#&gt; # ... with 196 more rows</span>
bt_resamples<span class="op">$</span>betas[[<span class="dv">1</span>]]
<span class="co">#&gt;   (Intercept)       beds     baths         sqft typeMulti_Family</span>
<span class="co">#&gt; 1     11.3463 -0.1208283 0.1030638 0.0005520435        0.1216251</span>
<span class="co">#&gt;   typeResidential</span>
<span class="co">#&gt; 1       0.2269614</span></code></pre></div>
<p>Note the sign of the coefficient for the number of bedroom is negative. This is not an error.</p>
</div>
<div id="using-recipes" class="section level2">
<h2 class="hasAnchor">
<a href="#using-recipes" class="anchor"></a>Using recipes</h2>
<p>The <a href="https://topepo.github.io/recipes/"><code>recipes</code></a> package contains a data preprocessor that can be used to avoid the potentially expensive formula methods as well as providing a richer set of data manipulation tools than base R can provide.</p>
<p>To define the design matrix, an initial recipe is created:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(recipes)

rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(price <span class="op">~</span><span class="st"> </span>beds <span class="op">+</span><span class="st"> </span>baths <span class="op">+</span><span class="st"> </span>sqft <span class="op">+</span><span class="st"> </span>type <span class="op">+</span><span class="st"> </span>city, 
              <span class="dt">data =</span> Sacramento) <span class="op">%&gt;%</span>
<span class="st">  </span>## Collapse rarely occurring cities into "other"
<span class="st">  </span><span class="kw">step_other</span>(city, <span class="dt">threshold =</span> <span class="fl">0.1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>## Dummy variables on the qualitative predictors 
<span class="st">  </span><span class="kw">step_dummy</span>(type, city) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">step_log</span>(price) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">step_center</span>(<span class="kw">all_predictors</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">step_scale</span>(<span class="kw">all_predictors</span>()) 
rec
<span class="co">#&gt; Data Recipe</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Inputs:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       role #variables</span>
<span class="co">#&gt;    outcome          1</span>
<span class="co">#&gt;  predictor          5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Steps:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Collapsing factor levels for city</span>
<span class="co">#&gt; Dummy variables from type, city</span>
<span class="co">#&gt; Log transformation on price</span>
<span class="co">#&gt; Centering for all_predictors()</span>
<span class="co">#&gt; Scaling for all_predictors()</span></code></pre></div>
<p>This recreates the work that the formula method traditionally uses with the additional steps that center and scale the predictors. <code>step_other</code> finds infrequently occurring cites and collapses them into a factor level called “other” to avoid columns that have all zeros for their dummy variables.</p>
<p>While the original data object <code>Sacramento</code> is used in the call, it is only used to define the variables and their characteristics so a single recipe is valid across all resampled versions of the data. The recipe can be estimated on the analysis component of the resample.</p>
<p>A function to fit the linear models using a recipe would then be:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lm_coefs_rec &lt;-<span class="st"> </span><span class="cf">function</span>(splits, rec, ...) {

  <span class="co"># Estimate the parameters using the analysis data</span>
  trained_rec &lt;-<span class="st"> </span><span class="kw">prepare</span>(rec, <span class="dt">training =</span> <span class="kw"><a href="../reference/as.data.frame.rsplit.html">analysis</a></span>(splits), 
                         <span class="dt">retain =</span> <span class="ot">TRUE</span>,
                         <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
  
  <span class="co"># Apply the transformations to the data set, save the </span>
  <span class="co"># predictor values, and convert to a matrix</span>
  design_matrix &lt;-<span class="st"> </span><span class="kw">extract</span>(trained_rec, <span class="kw">all_predictors</span>())
  design_matrix &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(design_matrix)
  
  <span class="co"># Get the logged price values and fit the model using `lm.fit`</span>
  y &lt;-<span class="st"> </span><span class="kw">extract</span>(trained_rec, <span class="kw">all_outcomes</span>())<span class="op">$</span>price
  
  <span class="kw">lm.fit</span>(<span class="dt">x =</span> design_matrix, <span class="dt">y =</span> y, ...)
}

bt_resamples<span class="op">$</span>fits &lt;-<span class="st"> </span><span class="kw">map</span>(bt_resamples<span class="op">$</span>splits, lm_coefs_rec, <span class="dt">rec =</span> rec)
bt_resamples
<span class="co">#&gt; # Bootstrap sampling with 200 resamples </span>
<span class="co">#&gt; # A tibble: 200 x 5</span>
<span class="co">#&gt;         splits           id statistic                betas       fits</span>
<span class="co">#&gt;         &lt;list&gt;        &lt;chr&gt;     &lt;dbl&gt;               &lt;list&gt;     &lt;list&gt;</span>
<span class="co">#&gt; 1 &lt;S3: rsplit&gt; Bootstrap001    -44227 &lt;data.frame [1 x 6]&gt; &lt;list [8]&gt;</span>
<span class="co">#&gt; 2 &lt;S3: rsplit&gt; Bootstrap002     19585 &lt;data.frame [1 x 6]&gt; &lt;list [8]&gt;</span>
<span class="co">#&gt; 3 &lt;S3: rsplit&gt; Bootstrap003     35000 &lt;data.frame [1 x 6]&gt; &lt;list [8]&gt;</span>
<span class="co">#&gt; 4 &lt;S3: rsplit&gt; Bootstrap004     50420 &lt;data.frame [1 x 6]&gt; &lt;list [8]&gt;</span>
<span class="co">#&gt; # ... with 196 more rows</span></code></pre></div>
<p>From these objects, we can extract the coefficients, fit statistics, and other values.</p>
</div>
<div id="keeping-tidy" class="section level2">
<h2 class="hasAnchor">
<a href="#keeping-tidy" class="anchor"></a>Keeping Tidy</h2>
<p>The <a href="https://cran.r-project.org/package=broom"><code>broom</code> package</a> contains a class called <code>tidy</code> that created representations of objects that can be easily used for analysis, plotting, etc. <code>rsample</code> contains <code>tidy</code> methods for <code>rset</code> and <code>rsplit</code> objects. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">first_resample &lt;-<span class="st"> </span>bt_resamples<span class="op">$</span>splits[[<span class="dv">1</span>]]
<span class="kw">class</span>(first_resample)
<span class="co">#&gt; [1] "rsplit"     "boot_split"</span>
<span class="kw">tidy</span>(first_resample)
<span class="co">#&gt; # A tibble: 932 x 2</span>
<span class="co">#&gt;     Row     Data</span>
<span class="co">#&gt;   &lt;int&gt;    &lt;chr&gt;</span>
<span class="co">#&gt; 1     1 Analysis</span>
<span class="co">#&gt; 2     3 Analysis</span>
<span class="co">#&gt; 3     6 Analysis</span>
<span class="co">#&gt; 4     9 Analysis</span>
<span class="co">#&gt; # ... with 928 more rows</span></code></pre></div>
<p>and</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(bt_resamples)
<span class="co">#&gt; [1] "bootstraps" "rset"       "tbl_df"     "tbl"        "data.frame"</span>
<span class="kw">tidy</span>(bt_resamples)
<span class="co">#&gt; # A tibble: 186,400 x 3</span>
<span class="co">#&gt;     Row     Data     Resample</span>
<span class="co">#&gt;   &lt;int&gt;    &lt;chr&gt;        &lt;chr&gt;</span>
<span class="co">#&gt; 1     1 Analysis Bootstrap001</span>
<span class="co">#&gt; 2     1 Analysis Bootstrap004</span>
<span class="co">#&gt; 3     1 Analysis Bootstrap007</span>
<span class="co">#&gt; 4     1 Analysis Bootstrap009</span>
<span class="co">#&gt; # ... with 186,396 more rows</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#model-assessment">Model Assessment</a></li>
      <li><a href="#using-the-bootstrap-to-make-comparisons">Using the Bootstrap to Make Comparisons</a></li>
      <li><a href="#bootstrap-estimates-of-model-coefficients">Bootstrap Estimates of Model Coefficients</a></li>
      <li><a href="#using-recipes">Using recipes</a></li>
      <li><a href="#keeping-tidy">Keeping Tidy</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Max Kuhn, <a href="http://hadley.nz">Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
